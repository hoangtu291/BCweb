var listJob = {
    "job01": {
        "hotennguoidang": "BraveBits Vietnam",
        "title": "[HN] Công Ty Công Nghệ BraveBits Tuyển Dụng Chuyên Viên Digital Marketing Full-time 2021",
        "hanchot": "01/01/2022",
        "logo": "data/images/bravebits-bg.png"
    },
    "job02": {
        "hotennguoidang": "Health's Finest Vietnam",
        "title": "[HN] Công Ty Health's Finest Vietnam Tuyển Dụng Thực Tập Sinh Vẽ Minh Hoạ Full-time 2021",
        "hanchot": "27/12/2021",
        "logo": "data/images/healthFin-item.png"
    },
    "job03": {
        "hotennguoidang": "Trần Thị B",
        "title": "[HCM] Công Ty Nhân Sự Đa Quốc Gia Adecco Tuyển Dụng Support Services Specialist Full-time 2021",
        "hanchot": "09/01/2022",
        "logo": "data/images/adecco-item.png"
    },
    "job04": {
        "hotennguoidang": "Glowie App Inc",
        "title": "[HCM] Công Ty Glowie App Tuyển Dụng Thực Tập Sinh Marketing Full-time 2021",
        "hanchot": "25/12/2021",
        "logo": "data/images/glowie-bg.png"
    },
    "job05": {
        "hotennguoidang": "I Like Fitness",
        "title": "[HN] Công Ty I Like Fitness Tuyển Dụng Nhân Viên Kinh Doanh Full-time 2021",
        "hanchot": "31/12/2021",
        "logo": "data/images/ilikefitness-bg.png"
    },
    "job06": {
        "hotennguoidang": "Phạm Thị T",
        "title": "[HN] Hệ Thống Giáo Dục Hallo English Tuyển Dụng Quản Lý Học Tập Full-time 2021",
        "hanchot": "20/01/2022",
        "logo": "data/images/halloenglish-bg.png"
    },
    "job07": {
        "hotennguoidang": "Lê Thảo N",
        "title": "[HCM] Công Ty Veritas Tuyển Dụng Thực Tập Sinh International Sales & Marketing 2021",
        "hanchot": "31/12/2021",
        "logo": "data/images/veritas-bg.png"
    },
    "job08": {
        "hotennguoidang": "Sài Gòn Đậm Đắng",
        "title": "[HCM] Thương Hiệu Cà Phê Sài Gòn Đậm Đắng Tuyển Dụng Nhân Viên Part-time/ Full-time 2021",
        "hanchot": "21/12/2021",
        "logo": "data/images/saigon-bg.png"
    },
    "job09": {
        "hotennguoidang": "Lê Thị N",
        "title": "[HCM] Công Ty Homecredit Tuyển Dụng Nhân Viên Bán Hàng Qua Điện Thoại Full-time 2021",
        "hanchot": "31/01/2022",
        "logo": "data/images/homecredit-bg.png"
    },
    "job10": {
        "hotennguoidang": "195 Global",
        "title": "[HCM] 195 Global Tuyển Dụng Nhân Viên Tư Vấn & Xử Lý Hồ Sơ Du Học Full-time 2021",
        "hanchot": "15/01/2022",
        "logo": "data/images/global-bg.png"
    },
    "job11": {
        "hotennguoidang": "Nguyễn Văn A",
        "title": "[HCM] Nền Tảng Thương Mại Điện Tử Shopee Tuyển Dụng Nhân Viên Campaign Operations Full-time 2021",
        "hanchot": "04/01/2022",
        "logo": "data/images/shopee-item.png"
    },
    "job12": {
        "hotennguoidang": "Nguyễn Thị Ngọc A",
        "title": "[HN] Công Ty Viet Corset Tuyển Dụng Nhân Viên Content Marketing Full-time 2021",
        "hanchot": "10/01/2022",
        "logo": "data/images/vietcorset-bg.png"
    },
    "job13": {
        "hotennguoidang": "Glowie App Inc",
        "title": "[HCM] Công Ty Glowie App Tuyển Dụng Quản Lý Product Full-time 2021",
        "hanchot": "20/01/2022",
        "logo": "data/images/glowie-bg.png"
    },
    "job14": {
        "hotennguoidang": "Nguyễn Văn T",
        "title": "[HCM] Nền Tảng Thương Mại Điện Tử Shopee Tuyển Dụng Thực Tập Sinh Software Engineer Full-time 2021",
        "hanchot": "31/12/2021",
        "logo": "data/images/shopee-item.png"
    },
    "job15": {
        "hotennguoidang": "Veritas Việt Nam",
        "title": "[HCM] Công Ty Veritas Tuyển Dụng Thực Tập Sinh International Sales & Marketing 2021",
        "hanchot": "31/12/2021",
        "logo": "data/images/veritas-bg.png"
    },
    "job16": {
        "hotennguoidang": "Manabie Việt Nam",
        "title": "[HCM] Công Ty Công Nghệ Giáo Dục Manabie Tuyển Dụng Cố Vấn Học Tập Toán Và Vật Lý Full-time 2021",
        "hanchot": "31/01/2022",
        "logo": "data/images/manabie-bg.png"
    }

}

var listHotPost = {
    "job17": {
        "nghenghiep": "Thiết kế đồ họa",
        "chude": "[HCM] Drviet Tuyển Dụng Nhân Viên Thiết Kế Đồ Họa",
        "hanchot": "20/01/2022",
        "luong": "4 triệu vnđ - 8 triệu vnđ / tháng",
        "kinhnghiem": "Cần có kinh nghiệm",
        "diachi": "TP Hồ Chí Minh",
        "tinhchatcongviec": "Toàn thời gian",
        "hinhanh": "data/images/drviet-bg.png",
    },
    "job18": {
        "nghenghiep": "Thiết kế đồ họa",
        "chude": "[HN] Clever Group Tuyển Dụng Nhân Viên Thiết Kế Đồ Họa",
        "hanchot": "20/01/2022",
        "luong": "8 triệu vnđ - 10 triệu vnđ / tháng",
        "kinhnghiem": "Không cần kinh nghiệm",
        "diachi": "Hà Nội",
        "tinhchatcongviec": "Toàn thời gian",
        "hinhanh": "data/images/clevergroup-bg.png",
    },
    "job19": {
        "nghenghiep": "Thiết kế đồ họa",
        "chude": "[HN] Tập Đoàn IDD Tuyển Dụng Nhân Viên Thiết Kế Đồ Họa",
        "hanchot": "31/12/2021",
        "luong": "8 triệu vnđ - 10 triệu vnđ / tháng",
        "kinhnghiem": "Cần có kinh nghiệm",
        "diachi": "Hà Nội",
        "tinhchatcongviec": "Toàn thời gian",
        "hinhanh": "data/images/idd-bg.png",
    },
    "job20": {
        "nghenghiep": "Kỹ sư phần mềm",
        "chude": "[HN/HCM] TalentSite Tuyển Dụng Thực Tập Sinh Software Engineer",
        "hanchot": "27/12/2021",
        "luong": "8 triệu vnđ - 10 triệu vnđ / tháng",
        "kinhnghiem": "Không cần kinh nghiệm",
        "diachi": "Hà Nội/TP Hồ Chí Minh",
        "tinhchatcongviec": "Toàn thời gian",
        "hinhanh": "data/images/talentsite-bg.png",
    },
    "job21": {
        "nghenghiep": "Giảng viên IELTS",
        "chude": "[Online] Trung Tâm Anh Ngữ Pasal Tuyển Dụng Giảng Viên IELTS",
        "hanchot": "30/12/2021",
        "luong": "4 trăm vnđ - 6 trăm vnđ / buổi",
        "kinhnghiem": "Không cần kinh nghiệm",
        "diachi": "Hà Nội/TP Hồ Chí Minh/Đà Nẵng",
        "tinhchatcongviec": "Bán thời gian",
        "hinhanh": "data/images/pasal-bg.png",
    },
    "job22": {
        "nghenghiep": "Nhân viên Marketing",
        "chude": "[HCM] Saint L'Beau Tuyển Dụng Nhân Viên Marketing",
        "hanchot": "31/12/2021",
        "luong": "4 triệu vnđ - 6 triệu vnđ / tháng",
        "kinhnghiem": "Cần có kinh nghiệm",
        "diachi": "TP Hồ Chí Minh",
        "tinhchatcongviec": "Bán thời gian",
        "hinhanh": "data/images/saint-bg.png",
    }
}


var scrollWindow = function () {
    $(window).scroll(function () {
        var $w = $(this),
            st = $w.scrollTop(),
            navbar = $('.my_navbar'),
            sd = $('.js-scroll-wrap');

        if (st > 150) {
            if (!navbar.hasClass('scrolled')) {
                navbar.addClass('scrolled');
            }
        }
        if (st < 150) {
            if (navbar.hasClass('scrolled')) {
                navbar.removeClass('scrolled sleep');
            }
        }
        if (st > 200) {
            if (!navbar.hasClass('awake')) {
                navbar.addClass('awake');
            }

            if (sd.length > 0) {
                sd.addClass('sleep');
            }
        }
        if (st < 200) {
            if (navbar.hasClass('awake')) {
                navbar.removeClass('awake');
                navbar.addClass('sleep');
            }
            if (sd.length > 0) {
                sd.removeClass('sleep');
            }
        }
    });
};
scrollWindow();

function showAccountNav() {
    if (sessionStorage.account !== undefined) {
        $('#btn-signin').addClass('d-none');
        $('#nav-account').removeClass('d-none');

        // gán dữ liệu trên session
        $('#nav-account .dropbtn a').html("Xin chào,&nbsp;&nbsp;&nbsp;" + JSON.parse(sessionStorage.account).name)
    }
}
showAccountNav();

function logOut() {
    var result = confirm("Bạn chắc chắn muốn đăng xuất");
    if (result) {
        sessionStorage.removeItem('account');
        window.location.href = "index.html";
    }
}

// chuyển trang Tạo CV

function checkRedirectCV() {
    if (sessionStorage.account === undefined) {
        var result = confirm("Bạn cần đăng nhập để thực hiện chức năng tạo CV");
        if (result) {
            window.location.href = "yboxClone/dangnhap.html";
        }
    } else {
        window.location.href = "createCV.html";
    }
}


function showBanner() {
    for (let i = 0; i < bannerList.length; i++) {
        $('#carou-inner-banner').append(`<div class="carousel-item${i == 0 ? " active" : ""}"><img src="${bannerList[i].image}" class="d-block w-100 img-banner"></div>`);
        $('#btn-carou-banner').append(`<button  type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="${i}" class="btn-circle ${i == 0 ? " active" : ""}" aria-current="true" aria-label="Slide ${i + 1}"></button>`)
    }

}

showBanner();

// ----------------------------

$('#customers-testimonials').owlCarousel({
    loop: true,
    center: false,
    items: 6,
    margin: 5,
    autoplay: true,
    dots: false,
    autoplayTimeout: 4000,
    smartSpeed: 300,
    responsive: {
        0: {
            items: 1
        },
        460: {
            items: 2
        },
        670: {
            items: 3
        },
        880: {
            items: 4
        },
        1250: {
            items: 5
        },
        1500: {
            items: 6
        }
    }
});


//load job

window.addEventListener('scroll', () => {
    setTimeout(function () {
        if (window.scrollY + window.innerHeight >=
            document.documentElement.scrollHeight) {
            loadJob();
            contentWayPoint();
        }
    }, 2000);
});

function loadJob() {
    for (let i = 0; i < Object.keys(listJob).length; i++) {
        var index = (i + 1) < 10 ? "0" + (i + 1) : i + 1;

        $('#listpost .container-list-post .row').append(`<div class="col-md-6 col-lg-3 ftco-animate">
            <div class="post-item card-item" id="${"job" + index}">
                <div class="item-post-header">
                    <div class="avatar-user btn-circle"></div>
                    <span class="name-user">${listJob["job" + index].hotennguoidang}&nbsp;</span>
                    <span class="time-post">&#8226;&nbsp;43 phút</span>
                </div>
                <div class="item-post-main">
                    <span class="title-post-card">${listJob["job" + index].title}</span>
                    <div class="end-date"><span class="txtEnd-date">${listJob["job" + index].hanchot}</span></div>
                    <div class="image-post-card"><img src="${listJob["job" + index].logo}" alt="Ảnh bài viết"
                            height="100%"></div>
                </div>
                <div class="item-post-footer">
                    <div class="around-btnsave-post btn-radCircle" data-bs-toggle="tooltip"
                        title="Lưu bài viết" onclick="savePost('${"job" + index}')">
                        <div class="btn-save-card btn-save btn-circle"></div>
                    </div>
                </div>
            </div>
        </div>`);
    }

    // SHOW ICON SAVE

    $('.post-item').mouseenter(function () {
        $(this).children('.item-post-footer').addClass('icon-save-show');

        $('.navbar-brand span').addClass('d-none');

        $('.navbar-brand .move-brand').addClass('move-re');
    });
    $('.post-item').mouseleave(function () {
        $(this).children('.item-post-footer').removeClass('icon-save-show');

        $('.navbar-brand span').removeClass('d-none');
        $('.navbar-brand .move-brand').removeClass('move-re');
    });

    $('.post-item .item-post-header, .post-item .item-post-main, #customers-testimonials .post-item-hot .footer-post .btn-seeDetail').click(function () {
        window.location.href = `details.html?job=${this.id}`;
    });

}
loadJob();

// ANIMATE

var contentWayPoint = function () {
    var i = 0;
    $('.ftco-animate').waypoint(function (direction) {

        if (direction === 'down' && !$(this.element).hasClass('ftco-animated')) {
            i++;
            $(this.element).addClass('item-animate');
            setTimeout(function () {

                $('body .ftco-animate.item-animate').each(function (k) {
                    var el = $(this);
                    setTimeout(function () {
                        el.addClass('ftco-animated');
                        el.removeClass('item-animate');
                    }, k * 50, 'easeInOutExpo');
                });

            }, 100);

        }

    }, { offset: '95%' });
};
contentWayPoint();

// function eventFunc() {
//     $('.post-item').click(redirectDetails());
// }

// SHOW ICON SAVE

$('.post-item').mouseenter(function showSave() {
    $(this).children('.item-post-footer').addClass('icon-save-show');

    $('.navbar-brand span').addClass('d-none');

    $('.navbar-brand .move-brand').addClass('move-re');
});
$('.post-item').mouseleave(function hiddenSave() {
    $(this).children('.item-post-footer').removeClass('icon-save-show');

    $('.navbar-brand span').removeClass('d-none');
    $('.navbar-brand .move-brand').removeClass('move-re');
});


// chuyển đến trang chi tiết
$('.post-item .item-post-header, .post-item .item-post-main, #customers-testimonials .post-item-hot .footer-post .btn-seeDetail').click(function () {
    window.location.href = `details.html?job=${this.id}`;
});

// chuyển đến trang đăng nhập
$('#btn-signin').click(function () {
    window.location.href = "yboxClone/dangnhap.html";
});

// chuyển đến trang xem bài viết đã lưu
$('#badge-listSave').click(function () {
    window.location.href = "save.html";
})


function hiddenModal(id) {
    $('#' + id).modal('hide');
}

function showProfile() {
    if (sessionStorage.account !== undefined) {
        var profileName = JSON.parse(sessionStorage.account).name;
        var sex = JSON.parse(sessionStorage.account).gender;
        var profileEmail = JSON.parse(sessionStorage.account).email;

        $('#profile-name').html(`${profileName}${sex == "Nam" ? `<i class="fas fa-mars ms-3"style="color: #4e88c5;"></i>` : `<i class="fas fa-venus ms-3" style="color: #f78888;"></i>`}`);
        $('#profile-birth').html(`<i class="fas fa-birthday-cake icon-yellow"></i>`);
        $('#profile-email').html(`<td><i class="fas fa-envelope icon-yellow"></i></td>
                                    <td>
                                        <p>${profileEmail}</p>
                                    </td>`);
        $('#profile-phone').html(`<td><i class="fas fa-phone icon-yellow"></i></td>
                                    <td>
                                        <p></p>
                                    </td>`);
        $('#profile-address').html(`<td><i class="fas fa-map-marker-alt icon-yellow"></i></i></td>
                                    <td>
                                        <p></p>
                                    </td>`);

    }
}


function saveProfile() {

    var profileName = $('#name').val();
    var sex = $('input[name=\'sex\']:checked').val();
    var profileBirth = $('#birth').val();
    var profileDetail = $('#comment').val();
    var profileEmail = $('#email').val();
    var profilePhone = $('#phone').val();
    var profileAddress = $('#address').val();

    $('#profile-name').html(`${profileName}${sex == "Nam" ? `<i class="fas fa-mars ms-3"style="color: #4e88c5;"></i>` : `<i class="fas fa-venus ms-3" style="color: #f78888;"></i>`}`);
    $('#profile-birth').html(`<i class="fas fa-birthday-cake icon-yellow"></i>${profileBirth}`);
    $('#profile-detail').html(profileDetail);
    $('#profile-email').html(`<td><i class="fas fa-envelope icon-yellow"></i></td>
                                    <td>
                                        <p>${profileEmail}</p>
                                    </td>`);
    $('#profile-phone').html(`<td><i class="fas fa-phone icon-yellow"></i></td>
                                    <td>
                                        <p>${profilePhone}</p>
                                    </td>`);
    $('#profile-address').html(`<td><i class="fas fa-map-marker-alt icon-yellow"></i></i></td>
                                    <td>
                                        <p>${profileAddress}</p>
                                    </td>`);

    hiddenModal('profileModal');
}

function saveEdu() {
    $('#edu-section').removeClass('d-none');

    var eduName = $('#schoolName').val();
    var eduAddress = $('#schoolAdd').val();
    var eduTime = $('#startSchool').val() + " - " + $('#endSchool').val();
    var eduGPA = $('#gpa').val();
    var eduTtich = $('#ttichEdu').val();

    $('#edu-section').append(`<div class="info-element">
                            <div class="profile-edit"><i class="fas fa-trash-alt icon-red" onclick="removeInfoElement(this)"></i></div>
                            <h5>${eduName}</h5>
                            <p class="address-date">${eduAddress} • ${eduTime}</p>
                            <p>GPA: ${eduGPA}</p>
                            <i>Thành tích: ${eduTtich}</i>
                        </div>`);

    hiddenModal('eduModal');
}

function saveWork() {
    $('#work-section').removeClass('d-none');

    var workPosi = $('#workPosition').val();
    var companyName = $('#company').val();
    var workAddress = $('#workAdd').val();
    var workTime = $('#startWork').val() + " - " + $('#endWork').val();
    var workTtich = $('#ttichWork').val();

    $('#work-section').append(`<div class="info-element">
                            <div class="profile-edit"><i class="fas fa-trash-alt icon-red" onclick="removeInfoElement(this)"></i></div>
                            <h5>${workPosi} @ ${companyName}</h5>
                            <p class="address-date">${workAddress} •  ${workTime}</p>
                            <p>Thành tích: ${workTtich}</p>
                        </div>`)

    hiddenModal('workModal');
}

function saveVolun() {
    $('#volun-section').removeClass('d-none');

    var volunPosi = $('#volunPosition').val();
    var eventName = $('#volunEvent').val();
    var volunAddress = $('#volunAdd').val();
    var volunTime = $('#startVolun').val() + " - " + $('#endVolun').val();
    var workTtich = $('#ttichVolun').val();

    $('#volun-section').append(`<div class="info-element">
                            <div class="profile-edit"><i class="fas fa-trash-alt icon-red" onclick="removeInfoElement(this)"></i></div>
                            <h5>${volunPosi} @ ${eventName}</h5>
                            <p class="address-date">${volunAddress} • ${volunTime}</p>
                            <p>Thành tích: ${workTtich}</p>
                        </div>`)

    hiddenModal('volunModal');
}

function saveSkill() {
    $('#skill-section').removeClass('d-none');

    var skillName = $('#skillName').val();
    var level = $('#levelSkill').val();
    var star = "";

    for (let i = 0; i < 5; i++) {
        if (i < level) {
            star += `<i class="fas fa-star"></i>`;
        }
        else {
            star += `<i class="far fa-star"></i>`;
        }
    }

    $('#skill-section').append(`<div class="info-element">
                            <div class="profile-edit"><i class="fas fa-trash-alt icon-red" onclick="removeInfoElement(this)"></i></div>
                            <h5>${skillName}</h5>
                            <p class="text-warning">
                                ${star}
                            </p>
                        </div>`);

    hiddenModal('skillModal');
}

function saveHobby() {
    $('#hobby-section').removeClass('d-none');

    var hobbyName = $('#hobbyName').val();

    $('#hobby-section').append(`<div class="info-element">
                            <div class="profile-edit"><i class="fas fa-trash-alt icon-red" onclick="removeInfoElement(this)"></i></div>
                            <h5>${hobbyName}</h5>
                        </div>`)

    hiddenModal('hobbyModal');
}

function removeInfoElement(element) {
    var idElement = $(element).parents('.section-cv').attr('id');
    // alert(idElement);
    $(element).parents('.info-element').remove();


    $(idElement).children().length
    if ($("#" + idElement).children('.info-element').length == 0) {
        $("#" + idElement).addClass('d-none');
    }
}


// LƯU BÀI VIẾT
function savePost(code) {
    var message = "Lưu bài viết thành công";
    var alert = "alert-success"
    if (localStorage[code] !== undefined) {
        message = "Lưu bài viết thất bại do bài viết đã được lưu trước đó";
        alert = "alert-danger"
    }

    if (listJob[code] !== undefined) {
        localStorage.setItem(code, JSON.stringify(listJob[code]));
    }
    else {
        localStorage.setItem(code, JSON.stringify(listHotPost[code]));
    }

    $('#alert').addClass(alert).removeClass('d-none');

    $('#alert').html(message);

    setTimeout(() => {
        $('#alert').addClass('hide-alert').removeClass(alert);

        setTimeout(() => {
            $('#alert').addClass('d-none').removeClass('hide-alert');
        }, 500);
    }, 1000);

    $('#badge-numSaved').html(localStorage.length);
}

function showListSave() {
    $('tbody#list-save').html("");

    if (localStorage.length == 0) {
        $('tbody#list-save').html(`<tr><td colspan="4" class="text-center"><b>Chưa có bài viết nào được lưu</b></td></tr>`)
    }

    for (let i = 0; i < localStorage.length; i++) {
        $('tbody#list-save').append(`<tr>
                        <td rowspan="2" style="height: 95px; width: fit-content;"><img
                                src="${JSON.parse(localStorage[localStorage.key(i)]).logo}" alt="Ảnh bài viết" height="100%"></td>
                        <td colspan="2" style="width: max-content;"><b>${JSON.parse(localStorage[localStorage.key(i)]).title}</b></td>
                        <td rowspan="2" class="text-center" style="width: 50px; height: 100%; line-height: 70px;"><i class="fas fa-trash-alt icon-red del-save" onclick="removeItemSave('${localStorage.key(i)}')"></i></td>
                    </tr>
                    <tr>
                        <td>
                            <div class="end-date"><span class="txtEnd-date">${JSON.parse(localStorage[localStorage.key(i)]).hanchot}</span></div>
                        </td>
                        <td class="text-end"><b>Lương:</b> ${JSON.parse(localStorage[localStorage.key(i)]).luong === undefined ? "Thỏa thuận" : JSON.parse(localStorage[localStorage.key(i)]).luong}</td>
                    </tr><tr><th colspan="4"></th></tr>`);
    }
    $('#badge-numSaved').html(localStorage.length);

}

$('#badge-numSaved').html(localStorage.length);

function removeItemSave(code) {
    if (localStorage[code] !== "undefined") {
        localStorage.removeItem(code);
        showListSave();
    }
}

window.onstorage = () => {
    showListSave();
};

// LOADED
setTimeout(function () { $('body').addClass('loaded'); }, 300);